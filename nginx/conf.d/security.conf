# Additional security configurations for RevEd Kids
# This file is included by the main nginx.conf

# Security headers for all responses
more_set_headers "X-Frame-Options: DENY";
more_set_headers "X-Content-Type-Options: nosniff";
more_set_headers "X-XSS-Protection: 1; mode=block";
more_set_headers "Referrer-Policy: strict-origin-when-cross-origin";
more_set_headers "X-Permitted-Cross-Domain-Policies: none";

# Remove server signature from error pages
more_set_headers "Server: RevEd-Kids/1.0";

# Hide sensitive headers from upstream
more_clear_headers "X-Powered-By";
more_clear_headers "Server" if ($upstream_http_server != "");

# Block common attack patterns
location ~ ^/(wp-|admin|phpmyadmin|mysql|drupal|joomla) {
    return 404;
}

# Block suspicious user agents
if ($http_user_agent ~* (bot|crawler|spider|scraper|scanner)) {
    return 403;
}

# Block requests with no user agent
if ($http_user_agent = "") {
    return 403;
}

# Block requests with malicious patterns
if ($request_uri ~* "(union|select|insert|delete|update|drop|create|alter|exec|script)") {
    return 403;
}